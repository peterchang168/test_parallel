machine:
  python:
    version: 2.6.8

dependencies:
  post:
    - pip install coverage

test:
  override:
    #- ./test/unittest.sh $(pwd)/
    #- cp /tmp/new_domain_redis_agent_test/report/* $CIRCLE_ARTIFACTS/
    - mkdir -p /tmp/new_domain_redis_agent_test
    - cp bin/new_domain_redis_agent.py /tmp/new_domain_redis_agent_test
    - cp test/unittest/unittest_new_domain_redis_agent.py /tmp/new_domain_redis_agent_test
    - mkdir -p /tmp/new_domain_redis_agent_test/report
    - nosetests -v -s -x --with-xunit --xunit-file=/tmp/new_domain_redis_agent_test/report/redis_agent_unit_result.xml --cover-erase --with-coverage --cover-package=new_domain_redis_agent -w /tmp/new_domain_redis_agent_test/ unittest_new_domain_redis_agent.py
    - coverage xml -o /tmp/new_domain_redis_agent_test/report/redis_agent_coverage.xml /tmp/new_domain_redis_agent_test/new_domain_redis_agent.py
  post:
    - mkdir -p $CIRCLE_TEST_REPORTS/junit/
    - ls -l $CIRCLE_TEST_REPORTS/
    - find /tmp/new_domain_redis_agent_test/report -type f -regex "*" -exec cp {} $CIRCLE_TEST_REPORTS/junit/ \;
    - ls -l $CIRCLE_TEST_REPORTS/junit/
